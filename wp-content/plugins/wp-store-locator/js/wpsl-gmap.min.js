jQuery(document).ready(function(e){var t,s,o,l,n,i,a,r,p,d,c,w,g,u,m,f,h=[],v=[],S=[],b={},C={},L={},y=!1,k=!1,x="undefined"!=typeof wpslSettings?wpslSettings.autoLoad:"";function I(e,t){V(e,0,"",!0,t),B(e,y,x,t)}function M(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function N(t,s){if(navigator.geolocation){var o,l,n=Number(wpslSettings.geoLocationTimout);o=setInterval(function(){e(".wpsl-icon-direction").toggleClass("wpsl-active-icon")},600),l=setTimeout(function(){E(o),I(t,s)},n),navigator.geolocation.getCurrentPosition(function(n){E(o),clearTimeout(l),F(!1),T(t,n,y,s),e(".wpsl-search").addClass("wpsl-geolocation-run")},function(o){if(e(".wpsl-icon-direction").hasClass("wpsl-user-activated")&&!e(".wpsl-search").hasClass("wpsl-geolocation-run")){switch(o.code){case o.PERMISSION_DENIED:alert(wpslGeolocationErrors.denied);break;case o.POSITION_UNAVAILABLE:alert(wpslGeolocationErrors.unavailable);break;case o.TIMEOUT:alert(wpslGeolocationErrors.timeout);break;default:alert(wpslGeolocationErrors.generalError)}e(".wpsl-icon-direction").removeClass("wpsl-active-icon")}else e(".wpsl-search").hasClass("wpsl-geolocation-run")||(clearTimeout(l),I(t,s))},{maximumAge:6e4,timeout:n,enableHighAccuracy:!0})}else alert(wpslGeolocationErrors.unavailable),I(t,s)}function E(t){clearInterval(t),e(".wpsl-icon-direction").removeClass("wpsl-active-icon")}function T(e,t,o,l){if(void 0===t)I(e,l);else{var i=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);n=t,Z(i),s.setCenter(i),V(i,0,"",!0,l),B(i,o,x,l)}}function P(){void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&void 0!==h[0]&&h[0].close()}function R(){void 0!==d&&""!==d&&(d.setMap(null),d="")}function O(t){var n,i,a,r,c;for(P(),c=t.parents("li").length>0?t.parents("li").data("store-id"):t.parents(".wpsl-info-window").data("store-id"),void 0!==d&&""!==d&&(i=d.getPosition()),C={centerLatlng:s.getCenter(),zoomLevel:s.getZoom()},n=0,r=v.length;n<r;n++)0!=v[n].storeId||void 0!==i&&""!==i?v[n].storeId==c&&(a=v[n].getPosition()):i=v[n].getPosition();i&&a?(e("#wpsl-direction-details ul").empty(),e(".wpsl-direction-before, .wpsl-direction-after").remove(),function(t,n){var i,a,r,c,w,g,u,m,f="",h={};u="km"==wpslSettings.distanceUnit?"METRIC":"IMPERIAL";h={origin:t,destination:n,travelMode:wpslSettings.directionsTravelMode,unitSystem:google.maps.UnitSystem[u]},l.route(h,function(t,l){if(l==google.maps.DirectionsStatus.OK){if(o.setMap(s),o.setDirections(t),t.routes.length>0){for(c=t.routes[0],w=0;w<c.legs.length;w++)for(i=c.legs[w],g=0,a=i.steps.length;g<a;g++)r=i.steps[g],f=f+"<li><div class='wpsl-direction-index'>"+(g+1)+"</div><div class='wpsl-direction-txt'>"+r.instructions+"</div><div class='wpsl-direction-distance'>"+r.distance.text+"</div></li>";for(e("#wpsl-direction-details ul").append(f).before("<div class='wpsl-direction-before'><a class='wpsl-back' id='wpsl-direction-start' href='#'>"+wpslLabels.back+"</a><div><span class='wpsl-total-distance'>"+c.legs[0].distance.text+"</span> - <span class='wpsl-total-durations'>"+c.legs[0].duration.text+"</span></div></div>").after("<p class='wpsl-direction-after'>"+t.routes[0].copyrights+"</p>"),e("#wpsl-direction-details").show(),w=0,a=v.length;w<a;w++)v[w].setMap(null);p&&p.clearMarkers(),void 0!==d&&""!==d&&d.setMap(null),e("#wpsl-stores").hide(),1==wpslSettings.templateId&&(m=e("#wpsl-gmap").offset(),e(window).scrollTop(m.top))}}else!function(e){var t;switch(e){case"NOT_FOUND":case"ZERO_RESULTS":t=wpslLabels.noDirectionsFound;break;case"OVER_QUERY_LIMIT":t=wpslLabels.queryLimit;break;default:t=wpslLabels.generalError}alert(t)}(l)})}(i,a)):alert(wpslLabels.generalError)}function U(e,t){var s,o,l;for(s=0,o=v.length;s<o;s++)v[s].storeId==e&&(l=v[s],"start"==t?l.setAnimation(google.maps.Animation.BOUNCE):l.setAnimation(null))}function z(e,t){V(e,0,"",!0,t),B(e,y,!1,t)}function Z(s){var o;t.geocode({latLng:s},function(t,s){s==google.maps.GeocoderStatus.OK?""!==(o=function(e){var t,s,o,l=e[0].address_components.length;for(o=0;o<l;o++)s=e[0].address_components[o].types,(/^postal_code$/.test(s)||/^postal_code,postal_code_prefix$/.test(s))&&(t=e[0].address_components[o].long_name);return t}(t))&&e("#wpsl-search-input").val(o):K(s)})}function B(e,s,o,l){var n,i;1==wpslSettings.directionRedirect?(n=e,i=function(){A(e,s,o,l)},t.geocode({latLng:n},function(e,t){t==google.maps.GeocoderStatus.OK?(c=e[0].formatted_address,i()):K(t)})):A(e,s,o,l)}function A(t,o,l,i){var a,r,p="",d=e("#wpsl-listing-template").html(),c=e("#wpsl-stores ul"),w=wpslSettings.url+"img/ajax-loader.gif";r=function(t,s,o){var l,i,a,r,p,d="",c=e("#wpsl-wrap").hasClass("wpsl-mobile"),w=e("#wpsl-wrap").hasClass("wpsl-default-filters"),g={action:"store_search",lat:t.lat(),lng:t.lng()};s?(g.max_results=wpslSettings.maxResults,g.search_radius=wpslSettings.searchRadius):(c||w?(l=parseInt(e("#wpsl-results .wpsl-dropdown").val()),i=parseInt(e("#wpsl-radius .wpsl-dropdown").val())):(l=parseInt(e("#wpsl-results .wpsl-selected-item").attr("data-value")),i=parseInt(e("#wpsl-radius .wpsl-selected-item").attr("data-value"))),isNaN(l)?g.max_results=wpslSettings.maxResults:g.max_results=l,isNaN(i)?g.search_radius=wpslSettings.searchRadius:g.search_radius=i,void 0!==wpslSettings.categoryIds?g.filter=wpslSettings.categoryIds:e("#wpsl-category").length>0?(d=c||w?parseInt(e("#wpsl-category .wpsl-dropdown").val()):parseInt(e("#wpsl-category .wpsl-selected-item").attr("data-value")),isNaN(d)||0===d||(g.filter=d)):e("#wpsl-checkbox-filter").length>0&&e("#wpsl-checkbox-filter input:checked").length>0&&(g.filter=e("#wpsl-checkbox-filter input:checked").map(function(){return e(this).val()}).get().join(",")),e(".wpsl-custom-dropdown").length>0&&e(".wpsl-custom-dropdown").each(function(t){a="",r="",c||w?(a=e(this).attr("name"),r=e(this).val()):(a=e(this).attr("name"),r=e(this).next(".wpsl-selected-item").attr("data-value")),a&&r&&(g[a]=r)}),e(".wpsl-custom-checkboxes").length>0&&e(".wpsl-custom-checkboxes").each(function(t){var s,o;(p=e(this).attr("data-name"))&&(g[p]=(s=e("[data-name="+p+"]"),o=[],e(s).find("input:checked").each(function(t){o.push(e(this).val())}),o.join()))}));1==o&&(void 0!==n?g.skip_cache=1:(g.autoload=1,void 0!==wpslSettings.categoryIds&&(g.filter=wpslSettings.categoryIds)));void 0!==wpslSettings.collectStatistics&&0==o&&(g.search=e("#wpsl-search-input").val());return g}(t,o,l),c.empty().append("<li class='wpsl-preloader'><img src='"+w+"'/>"+wpslLabels.preloader+"</li>"),e("#wpsl-wrap").removeClass("wpsl-no-results"),e.get(wpslSettings.ajaxurl,r,function(o){e(".wpsl-preloader, .no-results").remove(),o.length>0?(e.each(o,function(e){_.extend(o[e],j),V(new google.maps.LatLng(o[e].lat,o[e].lng),o[e].id,o[e],!1,i),p+=_.template(d)(o[e])}),e("#wpsl-result-list").off("click",".wpsl-directions"),c.empty(),c.append(p),e("#wpsl-result-list").on("click",".wpsl-directions",function(){if(1!=wpslSettings.directionRedirect)return O(e(this)),!1}),$(),e("#wpsl-result-list p:empty").remove()):(V(t,0,"",!0,i),a=function(){var e;e=void 0!==wpslSettings.noResults&&""!==wpslSettings.noResults?wpslSettings.noResults:wpslLabels.noResults;return e}(),e("#wpsl-wrap").addClass("wpsl-no-results"),c.html("<li class='wpsl-no-results-msg'>"+a+"</li>")),1==wpslSettings.runFitBounds?H():(s.setZoom(Number(wpslSettings.zoomLevel)),s.setCenter(v[0].position)),1==wpslSettings.resetMap&&(e.isEmptyObject(L)&&google.maps.event.addListenerOnce(s,"tilesloaded",function(){L={centerLatlng:s.getCenter(),zoomLevel:s.getZoom()},e("#wpsl-map-controls").addClass("wpsl-reset-exists"),e(".wpsl-icon-reset, #wpsl-reset-map").show()}),e(".wpsl-icon-reset").removeClass("wpsl-in-progress"))}),1!=wpslSettings.mouseFocus||M()||e("#wpsl-search-input").focus()}function $(){if(1==wpslSettings.markerClusters){var e,t=Number(wpslSettings.clusterZoom),o=Number(wpslSettings.clusterSize);isNaN(t)&&(t=""),isNaN(o)&&(o=""),void 0!==wpslSettings.excludeStartFromCluster&&1==wpslSettings.excludeStartFromCluster&&(e=v.slice(0)).splice(0,1),p=new MarkerClusterer(s,void 0===e?v:e,{gridSize:o,maxZoom:t})}}function V(t,o,l,n,i){var a,r,p,d;0===o?(l={store:wpslLabels.startPoint},a=b.url+wpslSettings.startMarker):a=void 0!==l.alternateMarkerUrl&&l.alternateMarkerUrl?l.alternateMarkerUrl:void 0!==l.categoryMarkerUrl&&l.categoryMarkerUrl?l.categoryMarkerUrl:b.url+wpslSettings.storeMarker,r={url:a,scaledSize:new google.maps.Size(Number(b.scaledSize[0]),Number(b.scaledSize[1])),origin:new google.maps.Point(Number(b.origin[0]),Number(b.origin[1])),anchor:new google.maps.Point(Number(b.anchor[0]),Number(b.anchor[1]))},p=new google.maps.Marker({position:t,map:s,optimized:!1,title:function(e){if(e)return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)})}(l.store),draggable:n,storeId:o,icon:r}),v.push(p),google.maps.event.addListener(p,"click",(d=s,function(){var s,n;0!=o?void 0!==wpslSettings.markerStreetView&&1==wpslSettings.markerStreetView?(s=t,n=function(){W(p,G(l),i,d)},(new google.maps.StreetViewService).getPanoramaByLocation(s,50,function(e,t){k=t==google.maps.StreetViewStatus.OK,n()})):W(p,G(l),i,d):W(p,wpslLabels.startPoint,i,d),google.maps.event.clearListeners(i,"domready"),google.maps.event.addListener(i,"domready",function(){var t,s;t=p,s=d,e(".wpsl-info-actions a").on("click",function(o){var l,n,i,a,r,p=Number(wpslSettings.autoZoomLevel);if(o.stopImmediatePropagation(),e(this).hasClass("wpsl-directions")){if(1==wpslSettings.directionRedirect)return!0;O(e(this))}else e(this).hasClass("wpsl-streetview")?(l=t,(i=(n=s).getStreetView()).setPosition(l.getPosition()),i.setVisible(!0),e("#wpsl-map-controls").hide(),a=i,r=n,google.maps.event.addListener(a,"visible_changed",function(){if(!a.getVisible()){var t=r.getZoom();e("#wpsl-map-controls").show(),r.setZoom(t-1),r.setZoom(t)}})):e(this).hasClass("wpsl-zoom-here")&&(s.setCenter(t.getPosition()),s.setZoom(p));return!1}),D()})})),n&&google.maps.event.addListener(p,"dragend",function(e){F(!0),s.setCenter(e.latLng),Z(e.latLng),B(e.latLng,y,x=!1,i)})}(_.templateSettings={evaluate:/\<\%(.+?)\%\>/g,interpolate:/\<\%=(.+?)\%\>/g,escape:/\<\%-(.+?)\%\>/g},e(".wpsl-gmap-canvas").length&&(e("<img />").attr("src",wpslSettings.url+"img/ajax-loader.gif"),e(".wpsl-gmap-canvas").each(function(a){!function(a,d){var c,w,g,u,m,f,h,v,C=Number(wpslSettings.zoomLevel),k=Number(wpslSettings.autoZoomLevel);g=function(e){var t,s,o,l,n,i,a,r=["zoomLevel","mapType","mapTypeControl","mapStyle","streetView","scrollWheel","controlPosition"],p={zoomLevel:wpslSettings.zoomLevel,mapType:wpslSettings.mapType,mapTypeControl:wpslSettings.mapTypeControl,mapStyle:wpslSettings.mapStyle,streetView:wpslSettings.streetView,scrollWheel:wpslSettings.scrollWheel,controlPosition:wpslSettings.controlPosition,gestureHandling:wpslSettings.gestureHandling};if(void 0!==window["wpslMap_"+e]&&void 0!==window["wpslMap_"+e].shortCode)for(t=0,s=r.length;t<s;t++)void 0!==(o=window["wpslMap_"+e].shortCode[r[t]])&&(p[r[t]]=o);return p.startLatLng=(l=e,a="",void 0!==window["wpslMap_"+l]&&void 0!==window["wpslMap_"+l].locations&&(a=window["wpslMap_"+l].locations[0]),void 0!==a&&void 0!==a.lat&&void 0!==a.lng?n=new google.maps.LatLng(a.lat,a.lng):""!==wpslSettings.startLatlng?(i=wpslSettings.startLatlng.split(","),n=new google.maps.LatLng(i[0],i[1])):n=new google.maps.LatLng(0,0),n),p}(d),(v=Number(g.zoomLevel))!==C&&(k=v);Z={},void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle?(O=wpslSettings.infoBoxClearance.split(","),U=wpslSettings.infoBoxPixelOffset.split(","),Z={alignBottom:!0,boxClass:wpslSettings.infoBoxClass,closeBoxMargin:wpslSettings.infoBoxCloseMargin,closeBoxURL:wpslSettings.infoBoxCloseUrl,content:"",disableAutoPan:!!Number(wpslSettings.infoBoxDisableAutoPan),enableEventPropagation:!!Number(wpslSettings.infoBoxEnableEventPropagation),infoBoxClearance:new google.maps.Size(Number(O[0]),Number(O[1])),pixelOffset:new google.maps.Size(Number(U[0]),Number(U[1])),zIndex:Number(wpslSettings.infoBoxZindex)},r=new InfoBox(Z)):r=new google.maps.InfoWindow,u=r,t=new google.maps.Geocoder,o=new google.maps.DirectionsRenderer,l=new google.maps.DirectionsService,c={zoom:v,center:g.startLatLng,mapTypeId:google.maps.MapTypeId[g.mapType.toUpperCase()],mapTypeControl:!!Number(g.mapTypeControl),scrollwheel:!!Number(g.scrollWheel),streetViewControl:!!Number(g.streetView),gestureHandling:g.gestureHandling,zoomControlOptions:{position:google.maps.ControlPosition[g.controlPosition.toUpperCase()+"_TOP"]}},b=function(){var e,t=wpslSettings.markerIconProps,s={};void 0!==t.url?s.url=t.url:void 0!==t.categoryMarkerUrl?s.categoryMarkerUrl=t.categoryMarkerUrl:void 0!==t.alternateMarkerUrl?s.alternateMarkerUrl=t.alternateMarkerUrl:s.url=wpslSettings.url+"img/markers/";for(var o in t)t.hasOwnProperty(o)&&2==(e=t[o].split(",")).length&&(s[o]=e);return s}(),s=new google.maps.Map(document.getElementById(a),c),E=g.mapStyle,(E=function(e){try{var t=JSON.parse(e);if(t&&"object"==typeof t&&null!==t)return t}catch(e){}return!1}(E))&&s.setOptions({styles:E}),void 0!==window["wpslMap_"+d]&&void 0!==window["wpslMap_"+d].locations&&(f=new google.maps.LatLngBounds,h=window["wpslMap_"+d].locations,e.each(h,function(e){V(m=new google.maps.LatLng(h[e].lat,h[e].lng),h[e].id,h[e],!1,u),f.extend(m)}),h.length>1&&(Y(s,k),s.fitBounds(f)),_.isArray(wpslSettings.mapTabAnchor)&&(w={map:s,bounds:f,maxZoom:k},S.push(w)));var E;var O,U,Z;e("#wpsl-gmap").length&&(1==wpslSettings.autoComplete&&function(){var t,s,o,l={};void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)||(l.componentRestrictions=wpslSettings.geocodeComponents);t=document.getElementById("wpsl-search-input"),(s=new google.maps.places.Autocomplete(t,l)).addListener("place_changed",function(){(o=s.getPlace()).geometry&&(i=o.geometry.location)})}(),!M()&&e(".wpsl-dropdown").length&&1==wpslSettings.enableStyledDropdowns?(j=Number(wpslSettings.maxDropdownHeight),e(".wpsl-dropdown").each(function(t){var s,o,l=e(this);l.$dropdownWrap=l.wrap("<div class='wpsl-dropdown'></div>").parent(),l.$selectedVal=l.val(),l.$dropdownElem=e("<div><ul/></div>").appendTo(l.$dropdownWrap),l.$dropdown=l.$dropdownElem.find("ul"),l.$options=l.$dropdownWrap.find("option"),l.hide().removeClass("wpsl-dropdown"),e.each(l.$options,function(){s=e(this).val()==l.$selectedVal?'class="wpsl-selected-dropdown"':"",l.$dropdown.append("<li data-value="+e(this).val()+" "+s+">"+e(this).text()+"</li>")}),l.$dropdownElem.before("<span data-value="+l.find(":selected").val()+" class='wpsl-selected-item'>"+l.find(":selected").text()+"</span>"),l.$dropdownItem=l.$dropdownElem.find("li"),l.$dropdownWrap.on("click",function(t){e(this).hasClass("wpsl-active")?e(this).removeClass("wpsl-active"):(q(),e(this).toggleClass("wpsl-active"),o=0,e(this).hasClass("wpsl-active")?(l.$dropdownItem.each(function(t){o+=e(this).outerHeight()}),l.$dropdownElem.css("height",o+2+"px")):l.$dropdownElem.css("height",0),o>j&&(e(this).addClass("wpsl-scroll-required"),l.$dropdownElem.css("height",j+"px")),t.stopPropagation())}),l.$dropdownItem.on("click",function(t){l.$dropdownWrap.find(e(".wpsl-selected-item")).html(e(this).text()).attr("data-value",e(this).attr("data-value")),l.$dropdownItem.removeClass("wpsl-selected-dropdown"),e(this).addClass("wpsl-selected-dropdown"),q(),t.stopPropagation()})}),e(document).click(function(){q()})):(e("#wpsl-search-wrap select").show(),M()?e("#wpsl-wrap").addClass("wpsl-mobile"):e("#wpsl-wrap").addClass("wpsl-default-filters")),e(".wpsl-search").hasClass("wpsl-widget")||(1==wpslSettings.autoLocate?N(g.startLatLng,u):1==wpslSettings.autoLoad&&I(g.startLatLng,u)),1!=wpslSettings.mouseFocus||M()||e("#wpsl-search-input").focus(),W=u,e("#wpsl-search-btn").unbind("click").bind("click",function(s){return e("#wpsl-search-input").removeClass(),e("#wpsl-search-input").val()?(e("#wpsl-result-list ul").empty(),e("#wpsl-stores").show(),e(".wpsl-direction-before, .wpsl-direction-after").remove(),e("#wpsl-direction-details").hide(),y=!1,P(),F(!1),R(),1==wpslSettings.autoComplete&&void 0!==i?z(i,W):(o=W,l={address:e("#wpsl-search-input").val()},void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)||(l.componentRestrictions=wpslSettings.geocodeComponents),t.geocode(l,function(e,t){t==google.maps.GeocoderStatus.OK?z(e[0].geometry.location,o):K(t)}))):e("#wpsl-search-input").addClass("wpsl-error").focus(),!1;var o,l}),B=g,A=s,$=u,google.maps.event.addListenerOnce(A,"tilesloaded",function(){var t,o;e(".gm-style").append(wpslSettings.mapControls),e(".wpsl-icon-reset, #wpsl-reset-map").length>0&&(t=B.startLatLng,o=$,e(".wpsl-icon-reset, #wpsl-reset-map").on("click",function(){e(this).hasClass("wpsl-in-progress")||(1==wpslSettings.autoLoad&&(x=1),s.getCenter().lat()===L.centerLatlng.lat()&&s.getCenter().lng()===L.centerLatlng.lng()&&s.getZoom()===L.zoomLevel||(F(!1),e("#wpsl-search-input").val("").removeClass(),e(".wpsl-icon-reset").addClass("wpsl-in-progress"),p&&p.clearMarkers(),R(),function(){var t,s,o,l,n,i,a,r,p=e("#wpsl-wrap").hasClass("wpsl-default-filters"),d=[wpslSettings.searchRadius+" "+wpslSettings.distanceUnit,wpslSettings.maxResults],c=["wpsl-radius","wpsl-results"];for(t=0,s=c.length;t<s;t++)e("#"+c[t]+" select").val(parseInt(d[t])),e("#"+c[t]+" li").removeClass(),"wpsl-radius"==c[t]?o=wpslSettings.searchRadius:"wpsl-results"==c[t]&&(o=wpslSettings.maxResults),e("#"+c[t]+" li").each(function(){e(this).text()===d[t]&&(e(this).addClass("wpsl-selected-dropdown"),e("#"+c[t]+" .wpsl-selected-item").html(d[t]).attr("data-value",o))});e("#wpsl-category").length&&(e("#wpsl-category select").val(0),e("#wpsl-category li").removeClass(),e("#wpsl-category li:first-child").addClass("wpsl-selected-dropdown"),l=e("#wpsl-category li:first-child").text(),e("#wpsl-category .wpsl-selected-item").html(l).attr("data-value",0)),e(".wpsl-custom-dropdown").length>0&&e(".wpsl-custom-dropdown").each(function(t){p?e(this).find("option").removeAttr("selected"):(n=e(this).siblings("div"),i=n.find("li:first-child"),a=i.text(),r=i.attr("data-value"),n.find("li").removeClass(),n.prev().html(a).attr("data-value",r))})}(),1==wpslSettings.autoLocate?T(t,n,!0,o):I(t,o)),e("#wpsl-stores").show(),e("#wpsl-direction-details").hide())}),e(".wpsl-icon-reset").hide()),e(".wpsl-icon-direction").on("click",function(){e(this).addClass("wpsl-user-activated"),N(B.startLatLng,$)})}),e(".wpsl-search").hasClass("wpsl-widget")&&(e("#wpsl-search-btn").trigger("click"),e(".wpsl-search").removeClass("wpsl-widget")));var B,A,$;var W;var j;void 0!==wpslSettings.markerZoomTo&&1==wpslSettings.markerZoomTo&&google.maps.event.addListener(s,"zoom_changed",function(){D()})}(e(this).attr("id"),a)}),function(){var t,o;if(_.isArray(wpslSettings.mapTabAnchor))for(t=0,o=S.length;t<o;t++)Q(S[t],wpslSettings.mapTabAnchor[t],t);else e("a[href='#"+wpslSettings.mapTabAnchor+"']").length&&Q(s,wpslSettings.mapTabAnchor)}()),e("#wpsl-result-list").on("click",".wpsl-back",function(){var t,l;for(o.setMap(null),t=0,l=v.length;t<l;t++)v[t].setMap(s);return void 0!==d&&""!==d&&d.setMap(s),p&&$(),s.setCenter(C.centerLatlng),s.setZoom(C.zoomLevel),e(".wpsl-direction-before, .wpsl-direction-after").remove(),e("#wpsl-stores").show(),e("#wpsl-direction-details").hide(),!1}),e("#wpsl-gmap").length&&("bounce"==wpslSettings.markerEffect?(e("#wpsl-stores").on("mouseenter","li",function(){U(e(this).data("store-id"),"start")}),e("#wpsl-stores").on("mouseleave","li",function(){U(e(this).data("store-id"),"stop")})):"info_window"==wpslSettings.markerEffect&&e("#wpsl-stores").on("mouseenter","li",function(){var t,o;for(t=0,o=v.length;t<o;t++)v[t].storeId==e(this).data("store-id")&&(google.maps.event.trigger(v[t],"click"),s.setCenter(v[t].position))})),void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&1==wpslSettings.markerClusters)&&google.maps.event.addListener(s,"zoom_changed",function(){google.maps.event.addListenerOnce(s,"idle",function(){if(void 0!==p&&(w=p.clusters_).length)for(m=0,g=w.length;m<g;m++)for(f=0,u=w[m].markers_.length;f<u;f++)if(w[m].markers_[f].storeId==a){r.getVisible()&&null===w[m].markers_[f].map?r.setVisible(!1):r.getVisible()||null===w[m].markers_[f].map||r.setVisible(!0);break}})});function W(e,t,s,o){h.length=0,s.setContent(t),s.open(o,e),h.push(s),void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&1==wpslSettings.markerClusters&&(a=e.storeId,s.setVisible(!0))}function D(){s.getZoom()>=wpslSettings.autoZoomLevel?e(".wpsl-zoom-here").hide():e(".wpsl-zoom-here").show()}var j={formatPhoneNumber:function(e){return 1==wpslSettings.phoneUrl&&M()&&(e="<a href='tel:"+j.formatClickablePhoneNumber(e)+"'>"+e+"</a>"),e},formatClickablePhoneNumber:function(e){return-1!=e.indexOf("+")&&-1!=e.indexOf("(0)")&&(e=e.replace("(0)","")),e.replace(/(-| |\(|\)|\.|)/g,"")},createInfoWindowActions:function(t){var s,o="",l="";return e("#wpsl-gmap").length&&(k&&(o="<a class='wpsl-streetview' href='#'>"+wpslLabels.streetView+"</a>"),1==wpslSettings.markerZoomTo&&(l="<a class='wpsl-zoom-here' href='#'>"+wpslLabels.zoomHere+"</a>"),s="<div class='wpsl-info-actions'>"+j.createDirectionUrl(t)+o+l+"</div>"),s},createDirectionUrl:function(t){var s,o,l={};return 1==wpslSettings.directionRedirect?(void 0===c&&(c=""),l.target="target='_blank'",void 0!==t?l.src=e("[data-store-id="+t+"] .wpsl-directions").attr("href"):(o=this.zip?this.zip+", ":"",s=this.address+", "+this.city+", "+o+this.country,l.src="https://www.google.com/maps/dir/?api=1&origin="+j.rfc3986EncodeURIComponent(c)+"&destination="+j.rfc3986EncodeURIComponent(s)+"&travelmode="+wpslSettings.directionsTravelMode.toLowerCase())):l={src:"#",target:""},"<a class='wpsl-directions' "+l.target+" href='"+l.src+"'>"+wpslLabels.directions+"</a>"},rfc3986EncodeURIComponent:function(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape)}};function G(t){var s;return s=e("#wpsl-base-gmap_0").length?e("#wpsl-cpt-info-window-template").html():e("#wpsl-info-window-template").html(),_.template(s)(t)}function H(){var e,t,o=Number(wpslSettings.autoZoomLevel),l=new google.maps.LatLngBounds;for(Y(s,o),e=0,t=v.length;e<t;e++)l.extend(v[e].position);s.fitBounds(l)}function F(e){var t,s;if(o.setMap(null),v){for(s=0,t=v.length;s<t;s++)e?1!=v[s].draggable?v[s].setMap(null):d=v[s]:v[s].setMap(null);v.length=0}p&&p.clearMarkers()}function K(e){var t;switch(e){case"ZERO_RESULTS":t=wpslLabels.noResults;break;case"OVER_QUERY_LIMIT":t=wpslLabels.queryLimit;break;default:t=wpslLabels.generalError}alert(t)}function q(){e(".wpsl-dropdown").removeClass("wpsl-active"),e(".wpsl-dropdown div").css("height",0)}function Q(t,s,o){var l,n,i,a,r,p=!!Number(wpslSettings.mapTabAnchorReturn),d=e("a[href='#"+s+"']");i=void 0!==t.maxZoom?t.maxZoom:Number(wpslSettings.autoZoomLevel),void 0!==o&&0==o&&d.addClass("wpsl-fitbounds"),d.on("click",function(){return setTimeout(function(){void 0!==t.map?(a=t.bounds,r=t.map):r=t,l=r.getZoom(),n=r.getCenter(),google.maps.event.trigger(r,"resize"),d.hasClass("wpsl-fitbounds")||(Y(r,i),r.setZoom(l),r.setCenter(n),void 0!==a?r.fitBounds(a):H(),d.addClass("wpsl-fitbounds"))},50),p})}function Y(e,t){google.maps.event.addListenerOnce(e,"bounds_changed",function(){google.maps.event.addListenerOnce(e,"idle",function(){this.getZoom()>t&&this.setZoom(t)})})}e("#wpsl-stores").on("click",".wpsl-store-details",function(){var t,s,o=e(this).parents("li"),l=o.data("store-id");if("info window"==wpslSettings.moreInfoLocation)for(t=0,s=v.length;t<s;t++)v[t].storeId==l&&google.maps.event.trigger(v[t],"click");else o.find(".wpsl-more-info-listings").is(":visible")?e(this).removeClass("wpsl-active-details"):e(this).addClass("wpsl-active-details"),o.siblings().find(".wpsl-store-details").removeClass("wpsl-active-details"),o.siblings().find(".wpsl-more-info-listings").hide(),o.find(".wpsl-more-info-listings").toggle();if("default"!=wpslSettings.templateId||"store listings"==wpslSettings.moreInfoLocation)return!1})});